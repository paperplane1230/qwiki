# Notes on TCP

## 保活定时器（keepalive）

如果一个给定的连接在两小时内没有任何动作，服务器就向客户发送一个探查报文段。客户端必须处于以下 4 个状态之一：

* 主机正常运行，且从服务器可达。客户 TCP 响应正常，服务器两小时后将保活定时器复位。如果期间有通信量通过此连接，则定时器在交换数据后的未来两小时再复位
* 客户端主机已崩溃，并且关闭 或者 正在重启。客户 TCP 无响应，75 秒后超时。服务器共发送 10 个这样的探查，每个间隔 75 秒。如果都没有响应，认为客户主机已关闭并终止连接
* 客户主机崩溃并已经重启。响应是一个复位，使服务器终止该连接
* 客户主机正常，但从服务器不可达。和状态 2 相同，TCP 不能区分该状态和状态 2 的区别

### 优点

* 通常比显式编写应用层探测报文容易
* 比应用层探测报文占用更少带宽（keepalive 探测报文和应答不包含任何数据）
* 如果连接不空闲，不会发送探测报文

### 缺点

* 可能会由于一个临时性的网络中断而断开连接
* 发送探测报文的间隔（2 小时）一般不可以根据应用进行配置
